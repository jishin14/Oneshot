<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/inventory/css/supplier.css">
    <link rel="stylesheet" href="/common/css/thymeleafView.css" />
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-barun-gothic.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css" />
</head>
<body>

<header>
    <div class="left">
        <img src="../../common/img/Logo.png" alt="Logo" class="left"/>
    </div>
    <div class="right">
        <img src="../../common/img/userCircle.png" alt="userCircle"/>
        <div>
            <p>신지윤</p>
            <p>개발1팀 / 사원</p>
            <p>cha@oneshot.com</p>
        </div>
        <div class="logout">
<!--            <img src="../../common/img/logout.svg" alt="logoutImg"/>-->
        </div>
    </div>
</header>

<div class="wrap">
    <aside class="aside left2">
        <div class="category">
            <div class="title">
                <i class="bi bi-house"></i>
                <p>홈</p>
            </div>
            <div class="submenu">
                <a href="#"><p>홈페이지</p></a>
                <a href="#"><p>내정보</p></a>
            </div>
        </div>
        <div class="category">
            <div class="title">
                <i class="bi bi-person-circle"></i>
                <p>인사관리</p></div>
            <div class="submenu">
                <a href="#"><p>사원관리</p></a>
                <a href="#"><p>부서관리</p></a>
            </div>
        </div>
        <div class="category">
            <div class="title">
                <i class="bi bi-box"></i>
                <p>재고관리</p>
            </div>
            <div class="submenu">
                <a href="#"><p>재고내역관리</p></a>
                <a href="/product/productList"><p>구매내역관리</p></a>
                <a href="/inventory/supplierList"><p>공급업체관리</p></a>
            </div>
        </div>
        <div class="category">
            <div class="title"><i class="bi bi-receipt"></i> 영업관리</div>
            <div class="submenu">
                <a href="/sales/contract"><p>거래가격관리</p></a>
                <a href="/sales/order"><p>판매내역관리</p></a>
            </div>
        </div>
    </aside>
    <div class="content">
        <div>

            <div id="supplier_wrapped">
                <div class="supplier_wrap"></div>
                <h1 class="title">공급업체내역</h1>
                <button type="button" class="search">검색</button>
                <table>
                    <thead class="title_name">
                    <tr>
                        <th></th>
                        <th>공급업체번호</th>
                        <th>공급업체명</th>
                        <th>공급업체주소</th>
                        <th>공급업체 사업자등록번호</th>
                        <th>담당자명</th>
                        <th>담당자 연락처</th>
                        <th>담당자 이메일</th>
                        <th>첨부파일</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="supplier : ${list}" >
                        <td><input type="checkbox"></td>
                        <td th:text="${supplier.supplierNo}"></td>
                        <td th:text="${supplier.supplierName}"></td>
                        <td th:text="${supplier.supplierAddress}"></td>
                        <td th:text="${supplier.supplierBusinessNo}"></td>
                        <td th:text="${supplier.managerName}"></td>
                        <td th:text="${supplier.managerPhone}"></td>
                        <td th:text="${supplier.managerEmail}"></td>
                        <td>
                            <a th:if="${supplier.supplierFile != null}" th:href="@{${supplier.supplierFile}}" target="_blank">조회</a>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="footer">
                    <button type="button" class="register" onclick="checkRegister()">업체등록</button>
                    <button type="button" class="update" onclick="openUpdate()">수정</button>
                </div>
            </div>

            <div class="modalPopup" id="modal">
                <div class="modal_content">
                    <div class="popup_header" id="popupHeader">
                        <span>공급업체 등록</span>
                    </div>
                    <form action="/inventory/registerSupplier" id="registerSupplier" method="post" enctype="multipart/form-data">
                        <div class="popup_content">
                            <table>
                                </tbody>
                                <tr class="modal_left">
                                    <td>
                                        <p>공급업체번호:</p>
                                        <input type="text" id="supplierNo" name="supplierNo" required disabled>
                                    </td>
                                    <td>
                                        <p>공급업체명:</p>
                                        <input type="text" id="supplierName" name="supplierName" required>
                                    </td>
                                    <td>
                                        <p>공급업체주소:</p>
                                        <input type="text" id="supplierAddress" name="supplierAddress" required><br><br>
                                    </td>
                                    <td>
                                        <p>공급업체 사업자등록번호:</p>
                                        <input type="text" id="supplierBusinessNo" name="supplierBusinessNo" pattern="\d{3}-\d{2}-\d{5}" placeholder="xxx-xx-xxxx" required><br><br>
                                    </td>
                                </tr>
                                <tr class="modal_right">
                                    <td>
                                        <p>담당자명:</p>
                                        <input type="text" id="managerName" name="managerName" required><br><br>
                                    </td>
                                    <td>
                                        <p>담당자 연락처:</p>
                                        <input type="text" id="managerPhone" name="managerPhone" pattern="\d{2,3}-\d{3,4}-\d{4}" placeholder="xx-xxxx-xxxx" required><br><br>
                                    </td>
                                    <td>
                                        <p>담당자 이메일:</p>
                                        <input type="email" id="managerEmail" name="managerEmail" pattern="[a-zA-Z0-9]+[@][a-zA-Z0-9]+[.]+[a-zA-Z]+[.]*[a-zA-Z]*" required><br><br>
                                    </td>
                                    <td>
                                        <p>첨부파일:</p>
                                        <input type="file" id="supplierFile" name="supplierFile" required><br><br>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="footer_button">
                            <button type="submit" class="save" onclick="saveSupplier()">등록</button>
                            <button type="button" class="close" onclick="closeModal()">닫기</button>
                        </div>
                    </form>
                </div>
            </div>


        </div>
    </div>
</div>
</body>
















<script>

//    thymeleaf js
    document.querySelectorAll('.title').forEach(function(title) {
        title.addEventListener('click', function() {
            const submenu = this.nextElementSibling; // 클릭된 title의 바로 다음 요소인 submenu

            // 클릭된 submenu만 토글
            if (submenu.classList.contains('open')) {
                submenu.classList.remove('open'); // 열려 있으면 닫기

            } else {
                // 다른 열린 submenu를 모두 닫음
                document.querySelectorAll('.submenu').forEach(function(sub) {
                    sub.classList.remove('open');
                });
                submenu.classList.add('open'); // 클릭된 요소만 열기
            }
        });
    });










    // 업체등록 버튼 클릭 시 체크박스가 선택되지 않았을 때만 모달 열기
    function checkRegister() {
        const checkedSupplier = document.querySelector('input[name="supplier"]:checked');
        if (checkedSupplier) {
            alert('선택을 해제해주세요');
        } else {
            openModal('register');
        }
    }

    // 수정 버튼 클릭 시 체크박스 선택 여부 확인하고 모달 열기
    function openUpdate() {
        const checkedSuppliers = document.querySelectorAll('input[name="supplier"]:checked');
        if (checkedSuppliers.length > 0) {
            // 공급업체 정보 로딩 및 모달 설정
            populateModal(checkedSuppliers[0].value);
            openModal('update'); // 체크된 항목이 있으면
        } else {
            alert('수정할 항목을 선택하세요.'); // 체크된 항목이 없으면
        }
    }

    // 모달 열기
    function openModal(mode) {
        const modal = document.getElementById("modal");
        const header = document.getElementById("popupHeader");

        if (mode === 'register') {
            header.innerHTML = '<span>공급업체 등록</span>';
            document.getElementById("registerSupplier").reset(); // 폼 초기화
        } else if (mode === 'update') {
            header.innerHTML = '<span>공급업체 수정</span>';
        }
        modal.style.display = "flex"; // 모달 열기
    }

    // 모달 닫기 + 내용 초기화
    function closeModal() {
        document.getElementById("modal").style.display = "none"; // 모달 닫기
        document.getElementById("registerSupplier").reset(); // 폼 내용 초기화
    }

    // 클릭 시 모달 닫기
    window.onclick = function(event) {
        if (event.target === document.getElementById('modal')) {
            closeModal();
        }
    };

    // 드래그가 시작되었는지 여부를 추적하는 변수
    let isDragging = false;
    // 드래그 시작 지점과 팝업의 초기 위치를 저장하는 변수
    let startX, startY, initialX, initialY;

    // 팝업과 헤더 요소 선택
    const draggablePopup = document.getElementById("modal");
    const popupHeader = document.getElementById("popupHeader");

    // 헤더의 마우스 다운 이벤트 리스너
    popupHeader.addEventListener("mousedown", function (event) {
        // 입력 필드 등에서의 마우스 클릭을 막지 않도록 조정
        if (event.target.closest('input, textarea, select')) {
            return;
        }

        isDragging = true;   // 드래그 상태를 true로 설정
        startX = event.clientX;   // 마우스 클릭 시 X 좌표 저장
        startY = event.clientY;   // 마우스 클릭 시 Y 좌표 저장
        const rect = draggablePopup.getBoundingClientRect();   // 팝업창의 현재 위치를 가져옴
        initialX = rect.left;   // 팝업의 초기 X 좌표 저장
        initialY = rect.top;   // 팝업의 초기 Y 좌표 저장
        // 텍스트 선택 방지
        event.preventDefault();
    });

    // 문서의 마우스 무브 이벤트 리스너
    document.addEventListener("mousemove", function (event) {
        // 마우스가 움직일 때 드래그가 활성화되어 있으면 팝업창의 위치를 업데이트
        if (isDragging) {
            const currentX = event.clientX;   // 현재 마우스의 X 좌표
            const currentY = event.clientY;   // 현재 마우스의 Y 좌표
            const dx = currentX - startX;   // 시작 X 좌표와 현재 X 좌표의 차이
            const dy = currentY - startY;   // 시작 Y 좌표와 현재 Y 좌표의 차이
            // 팝업창의 새로운 위치를 설정
            draggablePopup.style.left = `${initialX + dx}px`;
            draggablePopup.style.top = `${initialY + dy}px`;
        }
    });

    // 문서의 마우스 업 이벤트 리스너
    document.addEventListener("mouseup", function () {
        // 마우스 버튼을 떼었을 때 드래그를 종료
        isDragging = false; // 드래그 상태를 false로 설정
    });
</script>

</body>
</html>